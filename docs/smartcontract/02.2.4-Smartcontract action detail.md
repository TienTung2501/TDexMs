Nhóm **Quản trị viên (Protocol Admin)** nắm giữ "chìa khóa" vĩ mô của toàn bộ giao thức. Các hành động của nhóm này không can thiệp vào từng giao dịch Swap cụ thể của người dùng, mà tập trung vào việc điều hướng dòng tiền (thu phí), nâng cấp hệ thống và đảm bảo an toàn cho mạng lưới.

Đáng chú ý, Admin ở đây có thể là một ví cá nhân (đại diện bởi `VerificationKeyHash`) hoặc một hợp đồng đa chữ ký/DAO (đại diện bởi `ScriptHash`).

Dưới đây là luồng chi tiết các hành động đặc quyền của Protocol Admin:

### 1. Thu thập Phí Giao thức (Collect Fees)

Đây là hành động mang lại doanh thu cho dự án. Sàn DEX thu một phần nhỏ phí từ mỗi giao dịch Swap và tích lũy trực tiếp bên trong Pool.

* **Mục đích:** Rút phần phí giao dịch đã được tích lũy riêng biệt (`protocol_fees_a` và `protocol_fees_b`) từ dự trữ của một Pool về ví của dự án.
* **Cấu trúc Giao dịch (Tx Builder):**
* **Inputs (Đầu vào):** UTxO của Pool hiện tại tại địa chỉ `pool_validator`. Redeemer cung cấp là `CollectFees`.
* **Outputs (Đầu ra):**
* **Continuing Pool UTxO:** Gửi lại địa chỉ `pool_validator`. UTxO này chứa Pool NFT, số lượng dự trữ đã bị trừ đi đúng bằng phần phí giao thức, và `PoolDatum` cập nhật (reset các biến đếm phí về 0).
* **UTxO trả về ví Admin:** Chứa lượng tài sản A và B tương ứng với phí được rút ra.


* **Signatures (Chữ ký):** Chữ ký của ví Admin.


* **Xác thực On-chain (Validator Checks - `pool_validator`):**
* Xác nhận chữ ký của Admin hợp lệ (`check_signer`).


* 
**Bảo vệ Dự trữ (Reserve Protection):** Số lượng tài sản rút ra phải khớp chính xác tuyệt đối với `protocol_fees_a` và `protocol_fees_b` được ghi trong Datum cũ. Admin không thể lợi dụng đặc quyền để rút lẹm vào phần thanh khoản () của người dùng.


* Kiểm tra Datum mới: Cập nhật `protocol_fees_a` và `protocol_fees_b` về 0.


* Hằng số bất biến Root K được bảo toàn (`new_datum.last_root_k == old_datum.last_root_k`) vì phần phí này vốn dĩ đã được tách biệt khỏi dự trữ giao dịch.





### 2. Cập nhật Cấu hình Sàn (Update Factory Settings)

Sổ cái trung tâm (Factory) cần một người cầm trịch để thay đổi người quản trị mới hoặc trỏ đến một UTxO cấu hình (Settings) mới nếu có đợt nâng cấp.

* **Mục đích:** Thay đổi các trường quản trị cục bộ trong Factory.
* **Cấu trúc Giao dịch (Tx Builder):**
* **Inputs (Đầu vào):** UTxO Factory đang chứa Factory NFT (Thread Token). Redeemer là `UpdateSettings`.
* **Outputs (Đầu ra):** UTxO Factory mới tiếp nối tại địa chỉ `factory_validator`, chứa Datum mới với các thông số Admin hoặc tham chiếu cài đặt được cập nhật.
* **Signatures (Chữ ký):** Chữ ký của Admin hiện tại.


* **Xác thực On-chain (Validator Checks - `factory_validator`):**
* Giao dịch phải được ký bởi Admin hiện tại lưu trong Datum (`check_signer`).


* Đảm bảo Factory NFT (Token định danh sổ cái) được chuyển tiếp an toàn.


* Đảm bảo tổng số lượng Pool (`pool_count`) được giữ nguyên, Admin không được phép reset hay can thiệp vào bộ đếm này.





### 3. Cập nhật Cài đặt Giao thức Toàn cục (Update Protocol Settings)

Đây là hành động nâng cấp các quy tắc chung cho toàn bộ sàn DEX, ví dụ như giới hạn phí tối đa hay mức thanh khoản tối thiểu để mở Pool. Cấu hình này thường được quản lý bởi một Script (ví dụ: Hợp đồng Multi-sig của đội ngũ phát triển).

* **Mục đích:** Sửa đổi các tham số vĩ mô trong Settings UTxO.
* **Cấu trúc Giao dịch (Tx Builder):**
* **Inputs (Đầu vào):** UTxO Settings chứa Settings NFT. Redeemer là `UpdateProtocolSettings`.
* **Outputs (Đầu ra):** UTxO Settings mới chứa Datum được cập nhật thông số.
* **Signatures (Auth):** Giao dịch này yêu cầu kích hoạt thành công Admin Script (thường thông qua cơ chế rút tiền - withdrawal từ script) thay vì một chữ ký ví đơn thuần.


* **Xác thực On-chain (Validator Checks - `settings_validator`):**
* Xác minh Admin Script đã ủy quyền cho giao dịch (`check_admin_authorized`).


* 
**Phiên bản (Versioning):** Bắt buộc tham số `version` phải tăng lên đúng 1 đơn vị so với Datum cũ (`new_datum.version == old_datum.version + 1`). Điều này giúp các hệ thống Off-chain dễ dàng theo dõi các đợt nâng cấp.


* Kiểm tra tính hợp lệ của các thông số mới: Phí giao thức không được vượt quá giới hạn (`max_protocol_fee_bps`) và ngưỡng thanh khoản tối thiểu phải đáp ứng tiêu chuẩn an toàn (`min_settings_pool_liquidity`).





### 4. Đóng Pool Thanh khoản (Burn Pool NFT)

Hành động này được dự trù cho tương lai (future feature) để đối phó với các Pool bị lỗi hoặc cần gỡ bỏ khỏi hệ thống.

* **Mục đích:** Tiêu hủy danh tính (NFT) của một Pool.
* **Cấu trúc Giao dịch (Tx Builder):**
* **Inputs (Đầu vào):** UTxO của Pool cần đóng.
* **Mints (Đốt NFT):** Kích hoạt `pool_nft_policy` với redeemer `BurnPoolNFT`. Lượng đúc là -1.
* **Signatures (Chữ ký):** Chữ ký ví của Protocol Admin.


* **Xác thực On-chain (Validator Checks - `pool_nft_policy`):**
* Yêu cầu chữ ký xác thực của tài khoản Admin gốc (`check_signer(tx, admin_vkh)`).


* Hàm `check_exactly_one_burn` đảm bảo chỉ có duy nhất 1 Pool NFT bị tiêu hủy trong giao dịch đó.





---

**Một đính chính nhỏ về hành động `CreatePool` (Tạo Pool mới):**
Ở phần trước, tôi có xếp `CreatePool` vào nhóm hành động của Admin. Tuy nhiên, nếu soi kỹ vào mã nguồn `factory_validator.ak`, hợp đồng **không hề yêu cầu chữ ký của Admin** trong hàm `validate_create_pool`.

Điều này có nghĩa là kiến trúc này mang tính **Permissionless (Không cần cấp phép)** một phần: *Bất kỳ người dùng nào* cũng có thể tạo một cặp giao dịch mới, miễn là họ cung cấp đủ thanh khoản ban đầu, sắp xếp cặp tài sản đúng chuẩn (A < B), và trả đủ phí mạng lưới.

Bức tranh về hệ thống Smart Contract của SolverNet DEX đến đây đã hoàn thiện 100%. Từ thiết kế Intent độc đáo triệt tiêu độ trễ, hệ thống vệ tinh định tuyến (Keepers/Solvers), cho đến các cơ chế quản trị.
