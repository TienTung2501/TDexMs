Dựa trên bộ mã nguồn hợp đồng thông minh đã cung cấp, hệ thống SolverNet DEX phân chia các hành động (actions) tương tác rất rõ ràng dựa trên vai trò của từng thực thể tham gia vào mạng lưới.

Dưới đây là phân tích chi tiết tất cả các hành động cần thiết để xây dựng trọn vẹn các luồng giao dịch, được phân loại theo từng nhóm người dùng.

### 1. Nhóm Hành động của Người dùng (Traders)

Đây là các hành động được khởi tạo từ phía Frontend (Client) bởi người dùng muốn thực hiện giao dịch.

* **Tạo Lệnh Swap (Create Swap Intent):**
* Người dùng cần tạo một UTxO khóa tài sản của họ vào địa chỉ của `escrow_validator`.


* Giao dịch này bắt buộc phải đúc (mint) chính xác 1 Token Ý định (Intent Token) thông qua `intent_token_policy`. Tên của token này được tạo ra duy nhất (unique) dựa trên mã băm của UTxO đầu vào được tiêu thụ.




* **Tạo Lệnh Nâng cao (Limit, DCA, Stop-Loss):**
* Tương tự như Intent cơ bản, người dùng khóa tiền vào `order_validator`.


* Giao dịch này cũng tái sử dụng `intent_token_policy` để đúc token xác thực danh tính cho lệnh.




* **Hủy Lệnh (Cancel Order/Intent):**
* Đối với Intent cơ bản, người dùng gọi hành động `Cancel` trên `escrow_validator`. Hành động này yêu cầu chữ ký xác thực của chủ sở hữu. Giao dịch sẽ đốt (burn) Token Ý định và hoàn trả toàn bộ số dư đầu vào còn lại cho chủ sở hữu.


* Đối với các lệnh nâng cao, người dùng gọi hành động `CancelOrder` trên `order_validator`. Chủ sở hữu sẽ nhận lại ngân sách còn lại và token xác thực của lệnh sẽ bị đốt.





### 2. Nhóm Hành động của Người cung cấp thanh khoản (Liquidity Providers)

Nhóm này tương tác trực tiếp với Core AMM để kiếm lợi nhuận từ phí giao dịch.

* **Thêm Thanh khoản (Deposit):**
* Người dùng gọi hành động `Deposit` trên `pool_validator`.


* Nếu là lần nạp đầu tiên, số lượng LP Token đúc ra được tính toán dựa trên công thức khởi tạo.


* Đối với các lần nạp tiếp theo, số lượng tài sản nạp vào bắt buộc phải tuân theo đúng tỷ lệ dự trữ hiện tại của Pool. Giao dịch sẽ kích hoạt `lp_token_policy` để đúc ra số lượng LP Token tương ứng với phần hùn.




* **Rút Thanh khoản (Withdraw):**
* Người dùng gọi hành động `Withdraw` trên `pool_validator`.


* Giao dịch yêu cầu đốt số lượng LP Token tương ứng thông qua `lp_token_policy`.


* Hệ thống sẽ giải phóng một tỷ lệ tài sản tương ứng từ dự trữ của Pool trả về cho người dùng.





### 3. Nhóm Hành động của Solvers & Keepers (Backend/Bot)

Đây là linh hồn của mạng lưới Intent. Các hệ thống Bot off-chain liên tục quét các UTxO và thực hiện các hành động sau:

* **Khớp Lệnh Swap (Fill Intent):**
* Solver gọi hành động `Fill` trên `escrow_validator`.


* 
**Khớp Toàn phần (Complete Fill):** Solver tiêu thụ toàn bộ số dư đầu vào, đốt Token Ý định, và phải trả về cho người dùng số lượng tài sản đầu ra tối thiểu (min_output) theo tỷ lệ.


* 
**Khớp Một phần (Partial Fill):** Nhằm chống spam vi mô, Solver phải tiêu thụ ít nhất 10% số dư còn lại. Giao dịch này tạo ra một UTxO Escrow mới mang theo Token Ý định tiếp tục chờ khớp, đồng thời cập nhật số lần đã khớp (fill_count).




* **Thu hồi Lệnh Hết hạn (Reclaim):**
* Bất kỳ ai (thường là Keeper bot) đều có thể gọi hành động `Reclaim` trên `escrow_validator` đối với các lệnh đã hết hạn.


* Giao dịch bắt buộc phải diễn ra sau hạn chót (deadline). Token Ý định sẽ bị đốt và toàn bộ số tiền còn lại được trả về cho chủ sở hữu.




* **Thực thi Lệnh Nâng cao (Execute Order):**
* Keeper gọi hành động `ExecuteOrder` trên `order_validator`.


* 
**Limit Order:** Giá thực thi bắt buộc phải đạt mức giá mục tiêu thông qua kiểm tra phép nhân chéo (cross-multiplication). Có thể khớp toàn phần (đốt token) hoặc một phần (tiếp tục UTxO).


* 
**DCA Order:** Giao dịch phải tiêu thụ chính xác số lượng tài sản được quy định cho mỗi chu kỳ, trừ khi đó là lần khớp cuối cùng.


* 
**Stop-Loss Order:** Kích hoạt khi giá giảm dưới ngưỡng, hợp đồng sẽ chuyển đổi toàn bộ ngân sách còn lại và đốt token.




* **Định tuyến Swap trực tiếp (Direct Swap trên Pool):**
* Trong quá trình khớp lệnh cho người dùng, Solver sẽ tương tác gọi hành động `Swap` trên `pool_validator`.


* Hành động này đảm bảo bất biến tích không đổi (). Root K sau khi Swap không được phép giảm. Phí giao thức được trích lập và cập nhật vào biến số trong Datum.





### 4. Nhóm Hành động của Quản trị viên (Protocol Admin)

Các hành động này mang tính chất đặc quyền, kiểm soát hệ thống vĩ mô.

* **Tạo Pool Thanh khoản Mới (Create Pool):**
* Admin gọi hành động `CreatePool` trên `factory_validator`.


* Hành động này yêu cầu cặp tài sản phải được sắp xếp theo chuẩn từ điển (A < B) để tránh trùng lặp.


* Giao dịch đồng thời đúc ra chính xác 1 Pool NFT từ `pool_nft_policy` và đúc số lượng LP Token ban đầu từ `lp_token_policy`. Factory Datum sẽ được cập nhật để tăng biến đếm số lượng Pool.




* **Cập nhật Cài đặt Factory (Update Settings):**
* Admin gọi `UpdateSettings` trên `factory_validator`.


* Yêu cầu chữ ký của Admin, đảm bảo Factory NFT và số lượng Pool được giữ nguyên.




* **Cập nhật Cài đặt Giao thức (Update Protocol Settings):**
* Admin thao tác với `settings_validator` thông qua hành động `UpdateProtocolSettings`.


* Hệ thống kiểm tra xác thực của Admin, kiểm tra giới hạn của phí giao thức, và bắt buộc phải tăng tham số phiên bản (version) lên 1.




* **Thu thập Phí Giao thức (Collect Fees):**
* Admin gọi hành động `CollectFees` trên `pool_validator`.


* Hành động này trích xuất chính xác phần phí giao thức đã được tích lũy (không lấn vào dự trữ thanh khoản) và đặt các bộ đếm phí trong Datum về 0.




* **Đóng Pool (Burn Pool NFT):**
* Trong trường hợp cần thiết, Admin có thể gọi hành động `BurnPoolNFT` trên `pool_nft_policy`.


* Chỉ có Admin mới có quyền thực thi và đảm bảo chính xác 1 Pool NFT bị đốt đi.


